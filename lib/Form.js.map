{"version":3,"sources":["Form.js"],"names":["jp","validator","jsonPointers","allErrors","addFormat","JSONSchemaForm","isValidFormField","field","value","getValue","pointer","props","name","disabled","getData","type","schema","fields","reduceRight","data","set","validate","validity","checkValidity","states","isValid","first","reduce","state","i","len","length","dataPath","customValidity","setCustomValidity","message","findDOMNode","scrollIntoView","displayName","defaultProps","propTypes","object","isRequired","childContextTypes"],"mappings":";;;;;;;;;;;;;;;;;;;;;QAQYA,E;;;;AARZ;;;;;AAWA,QAAMC,YAAY,0CAAc;AAC5BC,sBAAc,IADc;AAE5BC,mBAAW;AAFiB,KAAd,CAAlB;;AAKAF,cAAUG,SAAV,CAAoB,OAApB,EAA6B,iBAA7B;;QAEqBC,c;;;;;;;;iCAEjBC,gB,6BAAiBC,K,EAAO;;AAEpB,gBAAMC,QAAQD,MAAME,QAAN,EAAd;AAFoB,gBAGbC,OAHa,GAGKH,KAHL,CAGbG,OAHa;AAAA,gBAGJC,KAHI,GAGKJ,KAHL,CAGJI,KAHI;AAAA,gBAIbC,IAJa,GAIKD,KAJL,CAIbC,IAJa;AAAA,gBAIPC,QAJO,GAIKF,KAJL,CAIPE,QAJO;;;AAMpB,mBAAOD,QACA,CAACC,QADD,IAEAL,SAAS,IAFT,IAGAE,OAHP;AAKH,S;;iCAEDI,O,sBAAU;;AAEN,gBAAMC,OAAO,KAAKJ,KAAL,CAAWK,MAAX,CAAkBD,IAA/B;;AAEA,mBAAO,KAAKE,MAAL,CAAYC,WAAZ,CACH,UAAUC,IAAV,EAAgBZ,KAAhB,EAAuB;AACnBP,mBAAGoB,GAAH,CAAOD,IAAP,EAAaZ,MAAMG,OAAnB,EAA4BH,MAAME,QAAN,EAA5B;AACA,uBAAOU,IAAP;AACH,aAJE,EAKHJ,SAAS,OAAT,GAAmB,EAAnB,GAAwB,EALrB,CAAP;AAQH,S;;iCAEDM,Q,uBAAW;AAAA;;AAEP,gBAAMF,OAAO,KAAKL,OAAL,EAAb;AACA,gBAAMQ,WAAW,KAAKC,aAAL,CAAmBJ,IAAnB,CAAjB;;AAEA,gBAAMK,SAASF,SAASE,MAAxB;AACA,gBAAMC,UAAUH,SAASG,OAAT,EAAhB;;AAEA,gBAAI,CAACA,OAAL,EAAc;AAAA;;AAEV,wBAAMR,SAAS,OAAKA,MAApB;;AAEA,wBAAMS,QAAQF,OAAOG,MAAP,CAAc,UAAUD,KAAV,EAAiBE,KAAjB,EAAwB;;AAEhD,6BAAK,IAAIC,IAAI,CAAR,EAAWC,MAAMb,OAAOc,MAA7B,EAAqCF,IAAIC,GAAzC,EAA8C,EAAED,CAAhD,EAAmD;;AAE/C,gCAAMtB,QAAQU,OAAOY,CAAP,CAAd;;AAEA,gCAAItB,MAAMG,OAAN,KAAkBkB,MAAMI,QAAxB,IACG,CAACzB,MAAMI,KAAN,CAAYsB,cADpB,EAEE;AACE1B,sCAAM2B,iBAAN,CAAwBN,MAAMO,OAA9B;AACA,uCAAOT,SAASnB,KAAhB;AACH;AAEJ;;AAED,+BAAOmB,KAAP;AAEH,qBAjBa,EAiBX,IAjBW,CAAd;;AAmBA,wBAAIA,KAAJ,EAAW;AACP,8CAASU,WAAT,CAAqBV,KAArB,EAA4BW,cAA5B;AACH;AAzBS;AA2Bb;;AAED,mBAAOZ,OAAP;AACH,S;;iCAEDF,a,0BAAcJ,I,EAAM;AAChB,mBAAO,KAAKR,KAAL,CAAWV,SAAX,CAAqBoB,QAArB,CAA8BF,IAA9B,EAAoC,IAApC,CAAP;AACH,S;;;;;yBAvEgBd,c;;;AA2ErBA,mBAAeiC,WAAf,GAA6B,gBAA7B;;AAEAjC,mBAAekC,YAAf,GAA8B;AAC1BtC;AAD0B,KAA9B;;AAIAI,mBAAemC,SAAf,+BACO,kBAAKA,SADZ;AAEIxB,gBAAQ,iBAAUyB,MAAV,CAAiBC;AAF7B;;AAKArC,mBAAesC,iBAAf,GAAmC,kBAAKA,iBAAxC","file":"Form.js","sourcesContent":["/**\n * @file melon json schema form\n * @author leon(ludafa@outlook.com)\n */\n\nimport {PropTypes} from 'react';\nimport Form from 'melon-core/Form';\nimport Validator from 'melon-json-schema-validator';\nimport * as jp from './pointer';\nimport ReactDOM from 'react-dom';\n\nconst validator = new Validator({\n    jsonPointers: true,\n    allErrors: true\n});\n\nvalidator.addFormat('color', /^#[0-9a-f]{6}$/i);\n\nexport default class JSONSchemaForm extends Form {\n\n    isValidFormField(field) {\n\n        const value = field.getValue();\n        const {pointer, props} = field;\n        const {name, disabled} = props;\n\n        return name\n            && !disabled\n            && value != null\n            && pointer;\n\n    }\n\n    getData() {\n\n        const type = this.props.schema.type;\n\n        return this.fields.reduceRight(\n            function (data, field) {\n                jp.set(data, field.pointer, field.getValue());\n                return data;\n            },\n            type === 'array' ? [] : {}\n        );\n\n    }\n\n    validate() {\n\n        const data = this.getData();\n        const validity = this.checkValidity(data);\n\n        const states = validity.states;\n        const isValid = validity.isValid();\n\n        if (!isValid) {\n\n            const fields = this.fields;\n\n            const first = states.reduce(function (first, state) {\n\n                for (let i = 0, len = fields.length; i < len; ++i) {\n\n                    const field = fields[i];\n\n                    if (field.pointer === state.dataPath\n                        && !field.props.customValidity\n                    ) {\n                        field.setCustomValidity(state.message);\n                        return first || field;\n                    }\n\n                }\n\n                return first;\n\n            }, null);\n\n            if (first) {\n                ReactDOM.findDOMNode(first).scrollIntoView();\n            }\n\n        }\n\n        return isValid;\n    }\n\n    checkValidity(data) {\n        return this.props.validator.validate(data, this);\n    }\n\n}\n\nJSONSchemaForm.displayName = 'JSONSchemaForm';\n\nJSONSchemaForm.defaultProps = {\n    validator\n};\n\nJSONSchemaForm.propTypes = {\n    ...Form.propTypes,\n    schema: PropTypes.object.isRequired\n};\n\nJSONSchemaForm.childContextTypes = Form.childContextTypes;\n"],"sourceRoot":"/source/"}